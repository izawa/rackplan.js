(function(b){function a(l,s,f){var c=[];var k=[];var q=[];var i=50;var d=5;$(function(){$.ajax({url:s,type:"GET",dataType:"xml",timeout:1000,success:j,error:n})});function j(u){for(var v=0;v<=$(u).find("rack").length-1;v++){var w=$(u).find("rack").eq(v).attr("name");c[w]=[];k[w]={size:$(u).find("rack").eq(v).attr("size")};q[w]={left:[],right:[]};for(var t=0;t<=$(u).find("rack").eq(v).find("mount").length-1;t++){c[w][$(u).find("rack").eq(v).find("mount").eq(t).attr("offset")]={size:$(u).find("rack").eq(v).find("mount").eq(t).attr("size"),color:$(u).find("rack").eq(v).find("mount").eq(t).attr("color"),label:$(u).find("rack").eq(v).find("mount").eq(t).attr("label"),label_color:$(u).find("rack").eq(v).find("mount").eq(t).attr("label_color")}}for(t=0;t<=$(u).find("rack").eq(v).find("net").length-1;t++){q[w][$(u).find("rack").eq(v).find("net").eq(t).attr("side")][q[w][$(u).find("rack").eq(v).find("net").eq(t).attr("side")].length]={member:p($(u).find("rack").eq(v).find("net").eq(t).attr("member")),color:$(u).find("rack").eq(v).find("net").eq(t).attr("color"),label:$(u).find("rack").eq(v).find("net").eq(t).attr("label")}}}m()}function n(){alert("XMLデータのロードに失敗しました")}function h(u,w,B,y,v,A){var x=w*23;var z=B*19+(B-1)*4;var t=x+2;u.drawRect({fillStyle:o(v)?v:"#eff",strokeStyle:"#aaa",x:i+2,y:d+t,fromCenter:false,width:296,height:z});u.drawText({fillStyle:o(A)?A:"#9cf",x:i+150,y:d+t+z/2,fontSize:14,fontFamily:"Verdana, sans-serif",text:y})}function r(t,u){var v=u*19+u*4;t.drawLine({strokeStyle:"#aaa",strokeWidth:1,x1:i+0,y1:d+0,x2:i+0,y2:d+v,x3:i+300,y3:d+v,x4:i+300,y4:d+0,closed:true})}function g(t,v){for(var u=1;u<v;u++){var w=u*23;t.drawLine({strokeStyle:"#aaa",strokeWidth:1,x1:i+0,y1:d+w,x2:i+5,y2:d+w});t.drawLine({strokeStyle:"#aaa",strokeWidth:1,x1:i+295,y1:d+w,x2:i+300,y2:d+w})}}function e(w,v){for(var x=0;x<q[v]["left"].length;x++){for(var u=0;u<q[v]["left"][x]["member"].length;u++){var t=(k[v]["size"]-q[v]["left"][x]["member"][u]-1)*23;var y=t+10;w.drawLine({strokeStyle:o(q[v]["left"][x]["color"])?q[v]["left"][x]["color"]:"black",strokeWidth:1,x1:i+0,y1:d+y,x2:i-10*(x+1),y2:d+y})}w.drawLine({strokeStyle:o(q[v]["left"][x]["color"])?q[v]["left"][x]["color"]:"black",strokeWidth:1,x1:i-10*(x+1),y1:d+(k[v]["size"]-q[v]["left"][x]["member"][0]-1)*23+10,x2:i-10*(x+1),y2:d+(k[v]["size"]-q[v]["left"][x]["member"][q[v]["left"][x]["member"].length-1]-1)*23+10});w.rotateCanvas({rotate:-90,x:i-10*(x+1)-2,y:((d+(k[v]["size"]-q[v]["left"][x]["member"][0]-1)*23+10)+(d+(k[v]["size"]-q[v]["left"][x]["member"][q[v]["left"][x]["member"].length-1]-1)*23+10))/2}).drawText({fillStyle:"#000",strokeWidth:1,x:i-10*(x+1),y:((d+(k[v]["size"]-q[v]["left"][x]["member"][0]-1)*23+10)+(d+(k[v]["size"]-q[v]["left"][x]["member"][q[v]["left"][x]["member"].length-1]-1)*23+10))/2,fontSize:11,fontFamily:"Verdana, sans-serif",text:q[v]["left"][x]["label"]}).restoreCanvas()}for(x=0;x<q[v]["right"].length;x++){for(u=0;u<q[v]["right"][x]["member"].length;u++){t=(k[v]["size"]-q[v]["right"][x]["member"][u]-1)*23;y=t+10;w.drawLine({strokeStyle:o(q[v]["right"][x]["color"])?q[v]["right"][x]["color"]:"black",strokeWidth:1,x1:i+300,y1:d+y,x2:i+300+10*(x+1),y2:d+y})}w.drawLine({strokeStyle:o(q[v]["right"][x]["color"])?q[v]["right"][x]["color"]:"black",strokeWidth:1,x1:i+300+10*(x+1),y1:d+(k[v]["size"]-q[v]["right"][x]["member"][0]-1)*23+10,x2:i+300+10*(x+1),y2:d+(k[v]["size"]-q[v]["right"][x]["member"][q[v]["right"][x]["member"].length-1]-1)*23+10});w.rotateCanvas({rotate:90,x:i+300+10*(x+1)+2,y:((d+(k[v]["size"]-q[v]["right"][x]["member"][0]-1)*23+10)+(d+(k[v]["size"]-q[v]["right"][x]["member"][q[v]["right"][x]["member"].length-1]-1)*23+10))/2}).drawText({fillStyle:"#000",strokeWidth:1,x:i+300+10*(x+1),y:((d+(k[v]["size"]-q[v]["right"][x]["member"][0]-1)*23+10)+(d+(k[v]["size"]-q[v]["right"][x]["member"][q[v]["right"][x]["member"].length-1]-1)*23+10))/2,fontSize:11,fontFamily:"Verdana, sans-serif",text:q[v]["right"][x]["label"]}).restoreCanvas()}}function p(t){var u=/\s*,\s*/;return(t.split(u).map(function(v){return(parseInt(v))}).sort(function(w,v){if(w<v){return -1}if(w>v){return 1}return 0}))}function o(t){if(typeof t==="undefined"){return false}else{return true}}function m(){for(var w in c){var v=$("<div/>",{"class":o(f)?f:"col-md-5 col-sm-8"});v.append("<h1>"+w);var x=k[w]["size"]*19+k[w]["size"]*4+10;var u=$('<canvas width="400" height="'+x+'"/>').width(400).height(x);g(u,k[w]["size"]);r(u,k[w]["size"]);e(u,w);for(var t=0;t<k[w]["size"];t++){if(c[w][t]){h(u,k[w]["size"]-t-c[w][t]["size"],c[w][t]["size"],c[w][t]["label"],c[w][t]["color"],c[w][t]["label_color"])}}v.append(u);$(l).append(v)}}}b.Rackplan=a}(window));